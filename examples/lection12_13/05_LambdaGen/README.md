# Пример: Лямбда-генераторы и std::function

## Описание

Данный пример демонстрирует **лямбда-выражения, возвращающие другие лямбды** (higher-order functions) и использование **`std::function`** для хранения и передачи лямбда-выражений.

## Суть примера

### std::function для хранения лямбд

```cpp
std::function<void(int)> trace_lambda = [](int i) { 
    std::cout << i << " "; 
};
```

`std::function` - универсальная обертка для любых вызываемых объектов (функций, лямбд, функторов).

### Лямбда-генератор

```cpp
auto lambda_gen = [](int i) -> std::function<int(int)> {
    if (i < 10)
        return [i](int n) -> int { return i + n; };
    else
        return [i](int n) -> int { return i - n; };
};
```

Лямбда-генератор - это функция, которая **возвращает другую функцию** в зависимости от параметров.

## Принцип работы

1. **Генерация лямбды** - `lambda_gen(25)` создает лямбду, которая вычитает из 25
2. **Немедленный вызов** - `lambda_gen(25)(5)` генерирует и сразу вызывает: `25 - 5 = 20`
3. **Сохранение лямбды** - `auto lll = lambda_gen(15)` сохраняет лямбду для последующего использования
4. **Применение в алгоритмах** - `std::transform` использует сохраненную лямбду

## Захват в возвращаемых лямбдах

```cpp
return [i](int n) -> int { return i + n; };
```

Возвращаемая лямбда **захватывает** параметр `i` из внешней лямбды:
- `i` копируется в возвращаемую лямбду
- Каждая возвращаемая лямбда имеет свое значение `i`
- Это создает **замыкание** (closure)

## std::function vs auto

| `std::function` | `auto` |
|----------------|--------|
| Универсальная обертка | Выводит конкретный тип |
| Можно переприсваивать | Тип фиксирован |
| Небольшой overhead | Нет overhead |
| Нужен для возврата из функций | Нельзя использовать в сигнатуре |

В данном примере `std::function` необходим, потому что:
- Лямбда возвращается из функции
- Нужен единый тип для разных лямбд
- Требуется возможность переприсваивания

## Higher-Order Functions

Лямбда-генератор - пример **функции высшего порядка** (higher-order function):
- Принимает параметры
- Возвращает функцию
- Возвращаемая функция "запоминает" параметры через замыкание

## Применение

```cpp
auto lll = lambda_gen(15);
std::transform(elements.begin(), elements.end(), elements.begin(), lll);
```

Сгенерированная лямбда применяется к каждому элементу:
- Если `i < 10`: элементы увеличиваются на `i`
- Если `i >= 10`: элементы уменьшаются на `i`

## Преимущества

- **Гибкость** - можно генерировать разные функции в зависимости от условий
- **Замыкания** - возвращаемые функции "помнят" параметры генератора
- **Переиспользование** - одну сгенерированную лямбду можно использовать многократно
- **Интеграция с STL** - сгенерированные лямбды работают с алгоритмами

## Связь с предыдущими примерами

- `02_Lambda` - базовые лямбды
- `03_LambdaReturn` - лямбды с возвращаемым типом
- `04_LambdaCapture` - захват переменных
- `05_LambdaGen` - лямбды, возвращающие лямбды (higher-order functions)

Это демонстрирует эволюцию от простых лямбд к функциям высшего порядка.

