#include <iostream>
#include <concepts>

// ============================================================================
// ДЕМОНСТРАЦИЯ СЛОЖНЫХ ПОЛЬЗОВАТЕЛЬСКИХ КОНЦЕПЦИЙ C++20
// ============================================================================

// ============================================================================
// СОЗДАНИЕ СЛОЖНОЙ КОНЦЕПЦИИ С ЛОГИЧЕСКИМИ ОПЕРАТОРАМИ
// ============================================================================

// Пользовательская концепция для числовых типов
// Исключает bool и char из числовых типов
template <typename T>
concept Number = (std::integral<T> || std::floating_point<T>) 
                 && !std::same_as<T, bool>
                 && !std::same_as<T, char>;

// ============================================================================
// ФУНКЦИЯ-ШАБЛОН С ИСПОЛЬЗОВАНИЕМ КОНЦЕПЦИИ
// ============================================================================

// Функция сложения с ограничениями на типы параметров
// Оба параметра должны удовлетворять концепции Number
template <Number T, Number U>
auto add(T first_number, U second_number){
    return first_number + second_number;
}

// ============================================================================
// ОСНОВНАЯ ФУНКЦИЯ - ДЕМОНСТРАЦИЯ СЛОЖНЫХ КОНЦЕПЦИЙ
// ============================================================================

int main(){
    std::cout << "=== ДЕМОНСТРАЦИЯ СЛОЖНЫХ ПОЛЬЗОВАТЕЛЬСКИХ КОНЦЕПЦИЙ C++20 ===" << std::endl << std::endl;
    
    // ========================================================================
    // ДЕМОНСТРАЦИЯ 1: ПРОВЕРКА КОНЦЕПЦИИ НА ЭТАПЕ КОМПИЛЯЦИИ
    // ========================================================================
    std::cout << "1. Проверка концепции на этапе компиляции:" << std::endl;
    static_assert(Number<int>);
    std::cout << "   static_assert(Number<int>) - успешно пройдено" << std::endl;
    std::cout << "   static_assert(Number<double>) - успешно пройдено" << std::endl;
    std::cout << "   static_assert(Number<bool>) - ошибка компиляции" << std::endl;
    std::cout << "   static_assert(Number<char>) - ошибка компиляции" << std::endl << std::endl;
    
    // ========================================================================
    // ДЕМОНСТРАЦИЯ 2: ИСПОЛЬЗОВАНИЕ ФУНКЦИИ С КОНЦЕПЦИЕЙ
    // ========================================================================
    std::cout << "2. Использование функции с концепцией:" << std::endl;
    auto addition_result = add(20.1, 20);
    std::cout << "   add(20.1, 20) = " << addition_result << std::endl;
    std::cout << "   Тип результата: " << typeid(addition_result).name() << std::endl << std::endl;
    
    // ========================================================================
    // ДЕМОНСТРАЦИЯ 3: ОБЪЯСНЕНИЕ СЛОЖНОЙ КОНЦЕПЦИИ
    // ========================================================================
    std::cout << "3. Объяснение сложной концепции Number:" << std::endl;
    std::cout << "   - std::integral<T> || std::floating_point<T> - целочисленные ИЛИ с плавающей точкой" << std::endl;
    std::cout << "   - !std::same_as<T, bool> - НЕ bool" << std::endl;
    std::cout << "   - !std::same_as<T, char> - НЕ char" << std::endl;
    std::cout << "   - Логические операторы: || (ИЛИ), && (И), ! (НЕ)" << std::endl;
    std::cout << "   - Комбинирование встроенных концепций" << std::endl << std::endl;
    
    // ========================================================================
    // ДЕМОНСТРАЦИЯ 4: ПРИМЕРЫ ТИПОВ, КОТОРЫЕ УДОВЛЕТВОРЯЮТ КОНЦЕПЦИИ
    // ========================================================================
    std::cout << "4. Примеры типов, которые удовлетворяют концепции Number:" << std::endl;
    std::cout << "   - int, long, short, unsigned int" << std::endl;
    std::cout << "   - double, float, long double" << std::endl;
    std::cout << "   - НЕ bool, char, wchar_t" << std::endl << std::endl;
    
    // ========================================================================
    // ДЕМОНСТРАЦИЯ 5: ПРЕИМУЩЕСТВА СЛОЖНЫХ КОНЦЕПЦИЙ
    // ========================================================================
    std::cout << "5. Преимущества сложных концепций:" << std::endl;
    std::cout << "   - Точное определение требований к типам" << std::endl;
    std::cout << "   - Исключение нежелательных типов" << std::endl;
    std::cout << "   - Комбинирование множества условий" << std::endl;
    std::cout << "   - Более читаемый код по сравнению с SFINAE" << std::endl;
    std::cout << "   - Лучшие сообщения об ошибках компиляции" << std::endl;
   
    return 0;
}